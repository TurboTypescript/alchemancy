var SketchLib=function(t){function e(e){for(var r,a,o=e[0],h=e[1],l=e[2],u=0,c=[];u<o.length;u++)a=o[u],n[a]&&c.push(n[a][0]),n[a]=0;for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(t[r]=h[r]);for(p&&p(e);c.length;)c.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],r=!0,o=1;o<i.length;o++){var h=i[o];0!==n[h]&&(r=!1)}r&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var r={},n={1:0},s=[];function a(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=r,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(i,r,function(e){return t[e]}.bind(null,r));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dist";var o=window.webpackJsonpSketchLib=window.webpackJsonpSketchLib||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var p=h;return s.push([90,0]),i()}({194:function(t,e){},196:function(t,e){},90:function(t,e,i){"use strict";i.r(e);var r=i(7),n=i(0),s=function(){function t(){}return t.rotatePoint=function(t,e,i,r,n){return{x:Math.cos(n)*(t-i)-Math.sin(n)*(e-r)+i,y:Math.sin(n)*(t-i)+Math.cos(n)*(e-r)+r}},t.calcTiltAngle=function(t,e){return{angle:Math.atan2(e,t)*(180/Math.PI),tilt:Math.max(Math.abs(t),Math.abs(e))}},t.lerp=function(t,e,i){return t+(e-t)*(i=(i=i<0?0:i)>1?1:i)},t.arrayPostDivide=function(t){for(var e=0;e<t.length;e+=4){var i=t[e+3];i&&(t[e]=Math.round(Math.min(255*t[e]/i,255)),t[e+1]=Math.round(Math.min(255*t[e+1]/i,255)),t[e+2]=Math.round(Math.min(255*t[e+2]/i,255)))}},t.pixelsToCanvas=function(t,e,i){var r=document.createElement("canvas");r.width=e,r.height=i;var n=r.getContext("2d"),s=n.createImageData(e,i);return s.data.set(t),n.putImageData(s,0,0),r},t.dataURLToFileContents=function(t){return t.replace(/^data:image\/\w+;base64,/,"")},t}(),a=function(){return function(t){this.name="default",this.blendMode="normal",this.sizeLimitMax=1,this.sizeLimitMin=0,this.opacityMax=1,this.opacityMin=0,this.spacing=0,this.brushImage="brushcharcoal",this.brushRotation=0,this.brushImageInvert=!1,this.grainImage="graingrid",this.grainRotation=0,this.grainImageInvert=!1,this.movement=1,this.scale=1,this.zoom=0,this.rotation=0,this.randomOffset=!0,this.azimuth=!0,this.pressureOpacity=1,this.pressureSize=1,this.pressureBleed=0,this.tiltAngle=0,this.tiltOpacity=1,this.tiltGradiation=0,this.tiltSize=1,this.orientToScreen=!0,t&&Object.assign(this,t)}}(),o=function(){return function(t){this.settings=new a(t)}}(),h=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),l=i(91),p=function(t){function e(e){var i=t.call(this,null,l,{uRed:{type:"1f",value:.5},uGreen:{type:"1f",value:.5},uBlue:{type:"1f",value:.5},uOpacity:{type:"1f",value:1},uRotation:{type:"1f",value:0},uBleed:{type:"1f",value:0},uGrainRotation:{type:"1f",value:0},uGrainScale:{type:"1f",value:1},u_x_offset:{type:"1f",value:0},u_y_offset:{type:"1f",value:0},u_offset_px:{type:"vec2"},u_node_scale:{type:"vec2",value:[0,0]},u_grainTex:{type:"sampler2D",value:""},dimensions:{type:"vec2",value:[0,0]},filterMatrix:{type:"mat3"}})||this;i.padding=0,i.blendMode=n.BLEND_MODES.NORMAL,i.autoFit=!1;var r=new n.Matrix;return e.renderable=!1,i.grainSprite=e,i.grainMatrix=r,i.uniforms.u_grainTex=e.texture,i.uniforms.filterMatrix=r,i}return h(e,t),e.prototype.apply=function(t,e,i,r){this.uniforms.dimensions[0]=e.sourceFrame.width,this.uniforms.dimensions[1]=e.sourceFrame.height,this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.grainMatrix,this.grainSprite),t.applyFilter(this,e,i,r)},e}(n.Filter),u=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),c=function(t){function e(e){var i=t.call(this)||this;return i.container=e,i.name="cursorSprite",i.gfx=new n.Graphics,i.addChild(i.gfx),i._enabled=!0,i.visible=!1,i.updateSize(),i}return u(e,t),e.prototype.renderCursor=function(t){this.lastPointer.set(t.x,t.y);var e=this.container.localizePoint(this.lastPointer);this.position.set(e.x,e.y),this.anchor.set(.5),this._enabled&&(this.visible=!0)},e.prototype.updateSize=function(){var t=.7*this.container.brushSize,e=Math.ceil(1*t/2),i=Math.ceil(1*t/2);this.gfx.clear().lineStyle(2,16777215,.001).drawCircle(e,i,Math.ceil(1*t)+2).closePath().lineStyle(1,16777215).drawCircle(e,i,Math.ceil(1*t)-1).closePath().lineStyle(1,0).drawCircle(e,i,Math.ceil(1*t)).closePath(),this.texture.destroy(!0),this.texture=this.gfx.generateCanvasTexture(),this.getLocalBounds(),this.gfx.clear()},e.prototype.setEnabled=function(t){this._enabled=t,this._enabled||(this.visible=!1)},e.prototype.getEnabled=function(){return this._enabled},e}(n.Sprite),d=function(){function t(t){this.renderer=t.renderer,this.width=t.width,this.height=t.height,this.name=t.name,this.sprite=new n.Sprite(n.RenderTexture.create(this.width,this.height)),this.sprite.name=t.name,this.container=new n.Container,this.container.name=t.name+" container",this.container.addChild(this.sprite),this.dirty=!1}return t.prototype.getOpacity=function(){return this.sprite.alpha},t.prototype.setOpacity=function(t){this.sprite.alpha=t},t.prototype.pixels=function(t){void 0===t&&(t=!1);var e=this.renderer.plugins.extract.pixels(this.sprite.texture);return t&&s.arrayPostDivide(e),e},t.prototype.toCanvas=function(t){void 0===t&&(t=!0);var e=this.pixels(t);return s.pixelsToCanvas(e,this.width,this.height)},t.prototype.toDataURL=function(t){return void 0===t&&(t=!0),this.toCanvas(t).toDataURL()},t.prototype.export=function(t){return s.dataURLToFileContents(this.toDataURL())},t.prototype.draw=function(t,e){void 0===e&&(e=!1),this.renderer.render(t,this.sprite.texture,e)},t.prototype.clear=function(){this.draw(new n.Sprite(n.Texture.EMPTY),!0)},t.prototype.replace=function(t,e){void 0===e&&(e=!0),this.draw(n.Sprite.from(t),e)},t.prototype.replaceTextureFromCanvas=function(t){n.utils.clearTextureCache(),this.replace(n.Texture.from(t))},t.prototype.applyMask=function(t){this.sprite.addChild(t),this.sprite.mask=t,this.rewrite(),this.sprite.mask=null,this.sprite.removeChild(t)},t.prototype.rewrite=function(){var t=this.sprite.alpha;this.sprite.alpha=1,this.replaceTexture(this.sprite),this.sprite.alpha=t},t.prototype.replaceTexture=function(t){var e=n.RenderTexture.create(this.width,this.height);this.renderer.render(t,e,!0),this.sprite.texture=e},t.prototype.isEmpty=function(){for(var t=0,e=this.renderer.plugins.extract.pixels(this.sprite.texture);t<e.length;t++){if(0!==e[t])return!1}return!0},t.prototype.getDirty=function(){return this.dirty},t.prototype.setDirty=function(t){this.dirty=t},t.prototype.setVisible=function(t){this.sprite.visible=t},t.prototype.getVisible=function(){return this.sprite.visible},t.prototype.flip=function(t){void 0===t&&(t=!1);var e=new n.Sprite(this.sprite.texture);e.anchor.set(.5,.5),t?(e.pivot.set(-e.width/2,e.height/2),e.scale.y*=-1):(e.pivot.set(e.width/2,-e.height/2),e.scale.x*=-1),this.replaceTexture(e)},t}(),f=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),y=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},g=function(t){function e(){return t.call(this)||this}return f(e,t),e.create=function(t){var i=Object.create(e.prototype);return i.renderer=t.renderer,i.width=t.width,i.height=t.height,i.onAdd=t.onAdd,i.onSelect=t.onSelect,i},e.prototype.create=function(t){var e=new d(y({renderer:this.renderer,width:this.width,height:this.height},t));return this.add(e),e},e.prototype.add=function(t){var e=this.length;return this.push(t),t.index=e,this.onAdd&&this.onAdd(t.index),t},e.prototype.markDirty=function(t){for(var e=0,i=t;e<i.length;e++){this[i[e]].setDirty(!0)}},e.prototype.getCurrentIndex=function(){return this.currentIndex},e.prototype.setCurrentIndex=function(t){this.currentIndex=t,this.onSelect&&this.onSelect(t)},e.prototype.getCurrentLayer=function(){return this[this.currentIndex]},e.prototype.flip=function(t){void 0===t&&(t=!1);for(var e=0;e<this.length;e++){this[e].flip(t)}},e.prototype.extractThumbnailPixels=function(t,e,i){void 0===i&&(i=[]);var r=PIXI.RenderTexture.create(t,e);return this.renderer.plugins.extract.pixels(this.generateCompositeTexture(t,e,i,r))},e.prototype.generateCompositeTexture=function(t,e,i,r){void 0===i&&(i=[]);for(var n=0;n<this.length;n++){var s=this[n];if(i.length&&i.includes(s.index)){var a=new PIXI.Sprite(s.sprite.texture);a.alpha=s.sprite.alpha,a.scale.set(t/this.width,e/this.height),this.renderer.render(a,r,!1)}}return r},e.prototype.asFlattenedCanvas=function(t,e,i){void 0===i&&(i=[]);var r=this.extractThumbnailPixels(t,e,i);return s.arrayPostDivide(r),s.pixelsToCanvas(r,t,e)},e.prototype.findByName=function(t){return this.find(function(e){return e.name===t})},e.prototype.merge=function(t,e){var i=PIXI.RenderTexture.create(this.width,this.height);i=this.generateCompositeTexture(this.width,this.height,t,i),this[e].clear(),this[e].replace(i);for(var r=0,n=t;r<n.length;r++){var s=n[r];s!==e&&this[s].clear()}},e}(Array),v=function(){function t(t){this.sketchPane=t.sketchPane}return t.prototype.set=function(t){this.areaPath=t},t.prototype.unset=function(){this.areaPath=null},t.prototype.children=function(){return this.areaPath.children?this.areaPath.children:[this.areaPath]},t.prototype.asPolygons=function(t){void 0===t&&(t=!0);for(var e=t?[-this.areaPath.bounds.x,-this.areaPath.bounds.y]:[0,0],i=[],r=0,s=this.children();r<s.length;r++){var a=s[r];i.push(new n.Polygon(a.segments.map(function(t){return new n.Point(t.point.x+e[0],t.point.y+e[1])})))}return i},t.prototype.asMaskSprite=function(t){var e;void 0===t&&(t=!1),n.utils.clearTextureCache();var i=document.createElement("canvas"),r=i.getContext("2d");r.globalAlpha=1,t?(i.width=this.sketchPane.width,i.height=this.sketchPane.height,r.fillStyle="#f00",r.rect(0,0,i.width,i.height),r.fill(),r.globalCompositeOperation="destination-out",r.fillStyle="#fff",e=this.asPolygons(!1)):(i.width=this.areaPath.bounds.width,i.height=this.areaPath.bounds.height,r.fillStyle="#f00",e=this.asPolygons(!0));for(var s=0,a=e;s<a.length;s++){var o=a[s];r.beginPath(),r.moveTo(o.points[0],o.points[1]);for(var h=2;h<o.points.length;h+=2)r.lineTo(o.points[h],o.points[h+1]);r.closePath(),r.fill()}return new n.Sprite(n.Texture.fromCanvas(i))},t.prototype.asOutlineSprite=function(){return n.utils.clearTextureCache(),new n.Sprite(n.Texture.fromCanvas(this.asOutlineCanvas()))},t.prototype.asFilledTexture=function(t,e){void 0===e&&(e=1);var i=this.asMaskSprite(!1),r=n.RenderTexture.create(this.areaPath.bounds.width,this.areaPath.bounds.height),s=new n.Graphics;return s.beginFill(t),s.drawRect(0,0,i.width,i.height),s.addChild(i),s.mask=i,s.alpha=e,this.sketchPane.app.renderer.render(s,r,!1),r},t.prototype.asSprite=function(t,e){void 0===e&&(e=!1);for(var i=new n.Sprite(n.RenderTexture.create(this.areaPath.bounds.width,this.areaPath.bounds.height)),r=this.asMaskSprite(),s=0,a=t;s<a.length;s++){var o=a[s],h=this.sketchPane.layers[o],l=new n.Rectangle(this.areaPath.bounds.x,this.areaPath.bounds.y,Math.min(this.areaPath.bounds.width,h.sprite.texture.width),Math.min(this.areaPath.bounds.height,h.sprite.texture.height)),p=new n.Sprite(new n.Texture(h.sprite.texture,l));p.alpha=e?1:h.getOpacity(),p.addChild(r),p.mask=r,i.addChild(p)}var u=new n.Sprite(n.RenderTexture.create(this.areaPath.bounds.width,this.areaPath.bounds.height));return this.sketchPane.app.renderer.render(i,u.texture,!1),u},t.prototype.asOutlineCanvas=function(){var t=this.asPolygons(!0),e=document.createElement("canvas"),i=e.getContext("2d");i.globalAlpha=1,e.width=this.areaPath.bounds.width,e.height=this.areaPath.bounds.height;for(var r=0,n=t;r<n.length;r++){var s=n[r];i.save(),i.lineWidth=1,i.strokeStyle="#fff",i.setLineDash([]),i.beginPath(),i.moveTo(s.points[0],s.points[1]);for(var a=2;a<s.points.length;a+=2)i.lineTo(s.points[a],s.points[a+1]);i.closePath(),i.stroke(),i.lineWidth=1,i.strokeStyle="#6A4DE7",i.setLineDash([2,5]),i.beginPath(),i.moveTo(s.points[0],s.points[1]);for(a=2;a<s.points.length;a+=2)i.lineTo(s.points[a],s.points[a+1]);i.closePath(),i.stroke(),i.restore()}return e},t.prototype.copy=function(t){for(var e=[],i=0,r=t;i<r.length;i++){var n=r[i],s=this.asSprite([n],!0);e[n]=s}return e},t.prototype.erase=function(t){for(var e=this.asMaskSprite(!0),i=0,r=t;i<r.length;i++){var n=r[i];this.sketchPane.layers[n].applyMask(e)}},t.prototype.paste=function(t,e){for(var i=0,r=t;i<r.length;i++){var n=r[i],s=this.sketchPane.layers[n],a=e[n];s.sprite.addChild(a),s.rewrite(),s.sprite.removeChild(a)}},t.prototype.fill=function(t,e,i){void 0===i&&(i=1);var r=this.asMaskSprite(!1),s=new n.Graphics;s.beginFill(e),s.drawRect(0,0,r.width,r.height),s.addChild(r),s.mask=r;for(var a=0,o=t;a<o.length;a++){var h=o[a],l=this.sketchPane.layers[h];l.sprite.addChild(s),s.x=this.areaPath.bounds.x,s.y=this.areaPath.bounds.y,s.alpha=i,l.rewrite(),l.sprite.removeChild(s)}},t}(),S=function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function a(t){try{h(r.next(t))}catch(t){s(t)}}function o(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(a,o)}h((r=r.apply(t,e||[])).next())})},m=function(t,e){var i,r,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},k=function(){function t(t){void 0===t&&(t={backgroundColor:16777215}),this.images={brush:{},grain:{}},this.efficiencyMode=!1,this.pointerDown=!1,this.layerMask=void 0,this.layerBackground=void 0,this.viewClientRect=void 0,this.containerPadding=50,this.onStrokeBefore=t.onStrokeBefore,this.onStrokeAfter=t.onStrokeAfter,this.setup(t),this.setImageSize(t.imageWidth,t.imageHeight),this.selectedArea=new v({sketchPane:this}),this.app.view.style.cursor="none"}return t.canInitialize=function(){return n.utils.isWebGLSupported()},t.prototype.setup=function(t){r.setup(void 0),r.view.setAutoUpdate(!1),r.view.remove(),new r.Path,n.settings.FILTER_RESOLUTION=1,n.settings.PRECISION_FRAGMENT=n.PRECISION.HIGH,n.settings.MIPMAP_TEXTURES=!0,n.settings.WRAP_MODE=n.WRAP_MODES.REPEAT,n.utils.skipHello(),this.app=new n.Application({backgroundColor:t.backgroundColor,antialias:!!this.efficiencyMode}),this.app.renderer.roundPixels=!1,this.app.renderer.plugins.interaction.destroy(),this.app.renderer.view.addEventListener("webglcontextlost",t.onWebGLContextLost),this.sketchPaneContainer=new n.Container,this.sketchPaneContainer.name="sketchPaneContainer",this.layersContainer=new n.Container,this.layersContainer.name="layersContainer",this.sketchPaneContainer.addChild(this.layersContainer),this.alphaFilter=new n.filters.AlphaFilter,this.liveContainer=new n.Container,this.liveContainer.name="live",this.strokeSprite=new n.Sprite,this.strokeSprite.name="static",this.segmentContainer=new n.Container,this.segmentContainer.name="segment",this.offscreenContainer=new n.Container,this.offscreenContainer.name="offscreen",this.offscreenContainer.renderable=!1,this.layersContainer.addChild(this.offscreenContainer),this.eraseMask=new n.Sprite,this.eraseMask.name="eraseMask",this.cursor=new c(this),this.sketchPaneContainer.addChild(this.cursor),this.app.stage.addChild(this.sketchPaneContainer),this.sketchPaneContainer.scale.set(1),this.viewClientRect=this.app.view.getBoundingClientRect(),this.zoom=1},t.prototype.setImageSize=function(t,e){this.width=t,this.height=e,this.layerMask=(new n.Graphics).beginFill(0,1).drawRect(0,0,this.width,this.height).endFill(),this.layerMask.lineAlignment=0,this.layerMask.name="layerMask",this.layersContainer.mask=this.layerMask,this.sketchPaneContainer.addChildAt(this.layerMask,this.sketchPaneContainer.getChildIndex(this.layersContainer)+1),this.layerBackground=(new n.Graphics).beginFill(16777215).drawRect(0,0,this.width,this.height).endFill(),this.layerBackground.lineAlignment=0,this.layerBackground.name="background",this.sketchPaneContainer.addChildAt(this.layerBackground,0),this.eraseMask.texture=n.RenderTexture.create(this.width,this.height),this.strokeSprite.texture=n.RenderTexture.create(this.width,this.height),this.centerContainer(),this.layers=g.create({renderer:this.app.renderer,width:this.width,height:this.height,onAdd:this.onLayersCollectionAdd.bind(this),onSelect:this.onLayersCollectionSelect.bind(this)})},t.prototype.onLayersCollectionAdd=function(t){var e=this.layers[t];this.layersContainer.position.set(0,0),this.layersContainer.addChild(e.container),this.centerContainer()},t.prototype.onLayersCollectionSelect=function(t){this.updateLayerDepths()},t.prototype.updateLayerDepths=function(){for(var t=0,e=this.layers;t<e.length;t++){var i=e[t];i.index===this.layers.currentIndex&&(i.container.addChild(this.strokeSprite),i.container.addChild(this.liveContainer))}},t.prototype.newLayer=function(t){return this.layers.create(t)},t.prototype.centerContainer=function(){if(this.anchor){var t=this.sketchPaneContainer.toLocal(this.anchor,this.app.stage);this.sketchPaneContainer.pivot.set(t.x,t.y),this.sketchPaneContainer.position.set(this.anchor.x,this.anchor.y)}else this.sketchPaneContainer.pivot.set(this.width/2,this.height/2),this.sketchPaneContainer.position.set(this.app.renderer.width/2,this.app.renderer.height/2)},t.prototype.resize=function(t,e){this.app.renderer.resize(t,e),this.viewClientRect=this.app.view.getBoundingClientRect();var i={width:Math.max(0,t-2*this.containerPadding),height:Math.max(0,e-2*this.containerPadding)},r={width:this.width,height:this.height},s=i.width/i.height>r.width/r.height?r.width*i.height/r.height:i.width;this.cursor.lastPointer||(this.cursor.lastPointer=new n.Point(this.app.renderer.width/2+this.viewClientRect.left,this.app.renderer.height/2+this.viewClientRect.top)),this.centerContainer(),this.sketchPaneContainer.scale.set(Math.floor(s)/Math.floor(r.width)*this.zoom),this.sketchPaneContainer.width=Math.ceil(this.sketchPaneContainer.width),this.sketchPaneContainer.height=Math.ceil(this.sketchPaneContainer.height)},t.prototype.loadBrushes=function(t){return S(this,void 0,void 0,function(){var e,i,r,s,a,h,l,p,u,c,d,f,y,g;return m(this,function(v){switch(v.label){case 0:for(e=t.brushes,i=t.brushImagePath,this.brushes=e.reduce(function(t,e){return t[e.name]=new o(e),t},{}),r=Array.from(new Set([].concat.apply([],Object.values(this.brushes).map(function(t){return[t.settings.brushImage,t.settings.efficiencyBrushImage]})).filter(Boolean))),s=Array.from(new Set(Object.values(this.brushes).map(function(t){return t.settings.grainImage}))),a=[],h=0,l=[[r,this.images.brush],[s,this.images.grain]];h<l.length;h++)for(p=l[h],u=p[0],c=p[1],d=function(t){var e=n.Sprite.fromImage(i+"/"+t+".png");e.renderable=!1,c[t]=e;var r=e.texture.baseTexture;r.hasLoaded?a.push(Promise.resolve(e)):r.isLoading?a.push(new Promise(function(e,i){r.on("loaded",function(t){e(r)}),r.on("error",function(e){i(new Error("Could not load brush from file: "+t+".png"))})})):a.push(Promise.reject(new Error("Failed to load brush from file: "+t+".png")))},f=0,y=u;f<y.length;f++)g=y[f],d(g);return[4,Promise.all(a)];case 1:return v.sent(),this.cursor.updateSize(),[2]}})})},t.prototype.stampStroke=function(t,e){e.draw(t,!1)},t.prototype.disposeContainer=function(t){for(var e=0,i=t.children;e<i.length;e++){i[e].destroy({children:!0,texture:!1,baseTexture:!1})}t.removeChildren()},t.prototype.addStrokeNode=function(t,e,i,r,s,a,o,h,l,u,c,d,f,y){var g=r-(1-h)*r*c.settings.pressureSize;g*=u/90*c.settings.tiltSize*3+1;var v,S=1-(1-h)*c.settings.pressureOpacity;S*=(1-u/90*c.settings.tiltOpacity)*s,v=c.settings.azimuth?l*Math.PI/180-this.sketchPaneContainer.rotation:0-this.sketchPaneContainer.rotation;var m=Math.pow(1-h,1.6)*c.settings.pressureBleed;if(this.efficiencyMode){(k=new n.Sprite(this.images.brush[c.settings.efficiencyBrushImage].texture)).position.set(a,o),k.anchor.set(.5),k.tint=n.utils.rgb2hex([t,e,i]),k.alpha=S,k.scale.set(g/k.width),y.addChild(k)}else{var k=new n.Sprite(this.images.brush[c.settings.brushImage].texture),x=45*Math.PI/180,C=Math.abs(g*Math.sin(x))+Math.abs(g*Math.cos(x)),w=Math.ceil(C);a-=w/2,o-=w/2,k.x=Math.floor(a),k.y=Math.floor(o),k.width=w,k.height=w;var P=a-k.x,b=o-k.y,M=g/k.width,_=[P,b],O=[M,M],I=this.images.grain[c.settings.grainImage];this.offscreenContainer.addChild(I),this.offscreenContainer.getLocalBounds();var L=new p(I);L.uniforms.uRed=t,L.uniforms.uGreen=e,L.uniforms.uBlue=i,L.uniforms.uOpacity=S,L.uniforms.uRotation=v,L.uniforms.uBleed=m,L.uniforms.uGrainScale=c.settings.scale,L.uniforms.uGrainRotation=c.settings.rotation,L.uniforms.u_x_offset=d*c.settings.movement,L.uniforms.u_y_offset=f*c.settings.movement,L.uniforms.u_offset_px=_,L.uniforms.u_node_scale=O,L.padding=1,k.filters=[L],y.addChild(k)}},t.prototype.down=function(t,e){void 0===e&&(e={}),this.pointerDown=!0,this.strokeBegin(t,e),this.app.view.style.cursor="none",this.cursor.renderCursor(t)},t.prototype.move=function(t){this.pointerDown&&this.strokeContinue(t),this.app.view.style.cursor="none",this.cursor.renderCursor(t)},t.prototype.up=function(t){this.pointerDown&&this.strokeEnd(t),this.app.view.style.cursor="none",this.cursor.renderCursor(t)},t.prototype.strokeBegin=function(t,e){this.strokeState={isErasing:!!e.erase,layerIndices:e.erase?e.erase:[this.layers.currentIndex],points:[],path:new r.Path,lastStaticIndex:0,lastSpacing:void 0,grainOffset:this.brush.settings.randomOffset?{x:Math.floor(100*Math.random()),y:Math.floor(100*Math.random())}:{x:0,y:0},size:this.brushSize,color:this.brushColor,nodeOpacityScale:this.nodeOpacityScale,strokeOpacityScale:this.strokeOpacityScale,layerOpacity:this.getLayerOpacity(this.layers.currentIndex),isStraightLine:!!e.isStraightLine,origin:void 0,straightLinePressure:e.straightLinePressure,shouldSnap:!!e.shouldSnap},this.onStrokeBefore&&this.onStrokeBefore(this.strokeState),this.addPointerEventAsPoint(t),this.strokeState.origin=this.strokeState.points[0],this.strokeState.straightLinePressure=null!=this.strokeState.straightLinePressure?this.strokeState.straightLinePressure:void 0,this.strokeState.isErasing?(this.liveContainer.parent&&this.liveContainer.parent.removeChild(this.liveContainer),this.strokeSprite.parent&&this.strokeSprite.parent.removeChild(this.strokeSprite)):(this.liveContainer.alpha=this.strokeState.layerOpacity*Math.pow(this.strokeState.strokeOpacityScale,5),this.strokeState.strokeOpacityScale<1?(this.setLayerOpacity(this.layers.currentIndex,1),this.alphaFilter.alpha=this.strokeState.layerOpacity,this.layers[this.layers.currentIndex].container.filters=[this.alphaFilter],this.strokeSprite.alpha=this.strokeState.strokeOpacityScale):(this.setLayerOpacity(this.layers.currentIndex,this.strokeState.layerOpacity),this.layers[this.layers.currentIndex].container.filters=[],this.strokeSprite.alpha=this.strokeState.layerOpacity),this.updateLayerDepths()),this.drawStroke()},t.prototype.strokeContinue=function(t){this.addPointerEventAsPoint(t),this.drawStroke()},t.prototype.strokeEnd=function(t){this.strokeState.isStraightLine||this.addPointerEventAsPoint(t),this.stopDrawing()},t.prototype.setIsStraightLine=function(t){if(this.strokeState&&(t||(this.strokeState.isStraightLine=!1),t&&!this.strokeState.isStraightLine)){this.strokeState.isStraightLine=!0;var e=this.strokeState.points.map(function(t){return t.pressure}).reduce(function(t,e){return t+e})/this.strokeState.points.length;this.strokeState.straightLinePressure=null!=this.strokeState.straightLinePressure?this.strokeState.straightLinePressure:e,this.drawStroke()}},t.prototype.getIsStraightLine=function(){return!!this.pointerDown&&!!this.strokeState&&this.strokeState.isStraightLine},t.prototype.setShouldSnap=function(t){this.strokeState&&this.strokeState.isStraightLine&&(this.strokeState.shouldSnap=t)},t.prototype.stopDrawing=function(t){void 0===t&&(t={cancel:!1}),t.cancel?(this.offscreenContainer.removeChildren(),this.disposeContainer(this.segmentContainer),this.disposeContainer(this.liveContainer),this.disposeContainer(this.strokeSprite),this.app.renderer.render(new n.Sprite(n.Texture.EMPTY),this.strokeSprite.texture,!0)):this.drawStroke(!0),this.layers.markDirty(this.strokeState.layerIndices),this.setLayerOpacity(this.layers.currentIndex,this.strokeState.layerOpacity),this.layers[this.layers.currentIndex].container.filters=[],this.updateLayerDepths(),this.pointerDown=!1,this.onStrokeAfter&&this.onStrokeAfter(this.strokeState)},t.prototype.getInterpolatedStrokeInput=function(t,e){for(var i=[],r=[],n=0;n<e.segments.length;n++)e.segments[n].location&&r.push(e.segments[n].location.offset);var a=0,o=Math.max(1,this.strokeState.size*(this.efficiencyMode?this.brush.settings.efficiencySpacing:this.brush.settings.spacing));null==this.strokeState.lastSpacing&&(this.strokeState.lastSpacing=o);var h=o-this.strokeState.lastSpacing,l=e.length,p=0,u=l+-(this.strokeState.lastSpacing+l),c=!1;for(0===l&&(h=0,l=o,c=!0),p=h;p<l;p+=o){for(var d=e.getPointAt(p),f=a;f<r.length;f++)r[f]<p&&(a=f);var y=void 0,g=void 0,v=void 0;if(c)y=t[a].pressure,g=t[a].tiltAngle,v=t[a].tilt;else{var S=(p-r[a])/(r[a+1]-r[a]);y=s.lerp(t[a].pressure,t[a+1].pressure,S),g=s.lerp(t[a].tiltAngle,t[a+1].tiltAngle,S),v=s.lerp(t[a].tilt,t[a+1].tilt,S)}i.push([this.strokeState.isErasing?0:(this.strokeState.color>>16&255)/255,this.strokeState.isErasing?0:(this.strokeState.color>>8&255)/255,this.strokeState.isErasing?0:(255&this.strokeState.color)/255,this.strokeState.size,this.strokeState.nodeOpacityScale,d.x,d.y,y,g,v,this.brush,this.strokeState.grainOffset.x,this.strokeState.grainOffset.y]),u=p}return this.strokeState.lastSpacing=l-u,i},t.prototype.addStrokeNodes=function(t,e,i){for(var r=0,n=this.getInterpolatedStrokeInput(t,e);r<n.length;r++){var s=n[r];this.addStrokeNode.apply(this,s.concat([i]))}},t.prototype.localizePoint=function(t){return this.sketchPaneContainer.toLocal(new n.Point(t.x-this.viewClientRect.left,t.y-this.viewClientRect.top),this.app.stage)},t.prototype.globalizePoint=function(t){var e=this.sketchPaneContainer.toGlobal(new n.Point(t.x,t.y));return e.x+=this.viewClientRect.left,e.y+=this.viewClientRect.top,e},t.prototype.addPointerEventAsPoint=function(t){var e=this.localizePoint(t),i="mouse"===t.pointerType?t.pressure>0?.5:0:t.pressure,n="mouse"===t.pointerType?{angle:-90,tilt:37}:s.calcTiltAngle(t.tiltY,t.tiltX);this.strokeState.points.push({x:e.x,y:e.y,pressure:i,tiltAngle:n.angle,tilt:n.tilt}),this.strokeState.lastStaticIndex=Math.max(0,this.strokeState.lastStaticIndex-1),this.strokeState.points=this.strokeState.points.slice(Math.max(0,this.strokeState.lastStaticIndex-1),this.strokeState.points.length),this.strokeState.path=new r.Path(this.strokeState.points),this.strokeState.points.length>1&&this.strokeState.path.smooth({type:"catmull-rom",factor:.5})},t.prototype.drawStroke=function(t){if(void 0===t&&(t=!1),this.strokeState.isStraightLine){this.app.renderer.render(new n.Sprite(n.Texture.EMPTY),this.strokeSprite.texture,!0);var e=(new n.Graphics).beginFill(16711680,1).drawRect(0,0,this.width,this.height).endFill();this.app.renderer.render(e,this.eraseMask.texture,!0);var i=this.strokeState.origin,s=this.strokeState.points[this.strokeState.points.length-1];if(s.pressure=i.pressure=this.strokeState.straightLinePressure,this.strokeState.shouldSnap){var a=Math.atan2(s.y-i.y,s.x-i.x),o=Math.hypot(s.x-i.x,s.y-i.y),h=(11.25*Math.round((180*a/Math.PI+180)/11.25)-180)*Math.PI/180;s.x=i.x+Math.cos(h)*o,s.y=i.y+Math.sin(h)*o}this.strokeState.points=[i,s,s],this.strokeState.lastStaticIndex=0,this.strokeState.path=new r.Path(this.strokeState.points)}var l=this.strokeState.points.length;if(t){var p=this.strokeState.lastStaticIndex,u=this.strokeState.points.length-1;return this.addStrokeNodes(this.strokeState.points.slice(p,u+1),new r.Path(this.strokeState.path.segments.slice(p,u+1)),this.segmentContainer),this.app.renderer.render(this.segmentContainer,this.strokeSprite.texture,!1),this.strokeState.isErasing?this.updateMask(this.segmentContainer,!0):(this.strokeSprite.alpha=this.strokeState.strokeOpacityScale,this.stampStroke(this.strokeSprite,this.layers.getCurrentLayer()),this.strokeState.strokeOpacityScale<1?this.strokeSprite.alpha=this.strokeState.strokeOpacityScale:this.strokeSprite.alpha=this.strokeState.layerOpacity),this.disposeContainer(this.segmentContainer),this.offscreenContainer.removeChildren(),this.disposeContainer(this.liveContainer),this.disposeContainer(this.strokeSprite),void this.app.renderer.render(new n.Sprite(n.Texture.EMPTY),this.strokeSprite.texture,!0)}if(l>=3){p=(c=this.strokeState.points.length-1)-2,u=c-1;this.addStrokeNodes(this.strokeState.points.slice(p,u+1),new r.Path(this.strokeState.path.segments.slice(p,u+1)),this.segmentContainer),this.strokeState.isErasing?this.updateMask(this.segmentContainer):this.app.renderer.render(this.segmentContainer,this.strokeSprite.texture,!1),this.disposeContainer(this.segmentContainer),this.offscreenContainer.removeChildren(),this.strokeState.lastStaticIndex=u}if(l>=2){this.disposeContainer(this.liveContainer);var c;p=(c=this.strokeState.points.length-1)-1,u=c;if(this.strokeState.isErasing);else{var d=this.strokeState.lastSpacing;this.addStrokeNodes(this.strokeState.points.slice(p,u+1),new r.Path(this.strokeState.path.segments.slice(p,u+1)),this.liveContainer),this.strokeState.lastSpacing=d}}},t.prototype.updateMask=function(t,e){var i=this;void 0===e&&(e=!1);if(!this.strokeState.layerIndices.map(function(t){return i.layers[t]}).sort(function(t,e){return function(t,e){return e-t}(t.sprite.parent.getChildIndex(t.sprite),e.sprite.parent.getChildIndex(e.sprite))})[0].sprite.mask){this.layersContainer.addChild(this.eraseMask);var r=(new n.Graphics).beginFill(16711680,1).drawRect(0,0,this.width,this.height).endFill();this.app.renderer.render(r,this.eraseMask.texture,!0);for(var s=0,a=this.strokeState.layerIndices;s<a.length;s++){var o=a[s];this.layers[o].sprite.mask=this.eraseMask}}if(this.app.renderer.render(t,this.eraseMask.texture,!1),e)for(var h=0,l=this.strokeState.layerIndices;h<l.length;h++){o=l[h];this.layers[o].applyMask(this.eraseMask)}},t.prototype.replaceLayer=function(t,e,i){void 0===i&&(i=!0),t=null==t?this.layers.getCurrentIndex():t,this.layers[t].replace(e,i)},t.prototype.getLayerCanvas=function(t){return console.warn("SketchPane#getLayerCanvas is deprecated. Please fix the caller to use a different method."),console.trace(),t=null==t?this.layers.getCurrentIndex():t,this.app.renderer.plugins.extract.canvas(this.layers[t].sprite.texture)},t.prototype.exportLayer=function(t,e){return void 0===e&&(e="base64"),t=null==t?this.layers.getCurrentIndex():t,this.layers[t].export(e)},t.prototype.extractThumbnailPixels=function(t,e,i){return void 0===i&&(i=[]),this.layers.extractThumbnailPixels(t,e,i)},t.prototype.clearLayer=function(t){t=null==t?this.layers.getCurrentIndex():t,this.layers[t].clear()},t.prototype.getNumLayers=function(){return this.layers.length-1},t.prototype.getCurrentLayerIndex=function(t){return this.layers.getCurrentIndex()},t.prototype.setCurrentLayerIndex=function(t){this.pointerDown||this.layers.setCurrentIndex(t)},Object.defineProperty(t.prototype,"brushSize",{get:function(){return this._brushSize},set:function(t){this._brushSize=t,this.cursor.updateSize()},enumerable:!0,configurable:!0}),t.prototype.isDrawing=function(){return this.pointerDown},t.prototype.getLayerOpacity=function(t){return this.layers[t].getOpacity()},t.prototype.setLayerOpacity=function(t,e){this.layers[t].setOpacity(e)},t.prototype.markLayersDirty=function(t){return this.layers.markDirty(t)},t.prototype.clearLayerDirty=function(t){this.layers[t].setDirty(!1)},t.prototype.getLayerDirty=function(t){return this.layers[t].getDirty()},t.prototype.isLayerEmpty=function(t){return this.layers[t].isEmpty()},t.prototype.getDOMElement=function(){return this.app.view},t.prototype.flipLayers=function(t){void 0===t&&(t=!1),this.layers.flip(t)},t}();i.d(e,"SketchPane",function(){return k}),i.d(e,"util",function(){return s})},91:function(t,e){t.exports="precision highp float;\n\n// brush texture\nuniform sampler2D uSampler;\n// grain texture\nuniform sampler2D u_grainTex;\n\n// color\nuniform float uRed;\nuniform float uGreen;\nuniform float uBlue;\n\n// node\nuniform float uOpacity;\nuniform float uRotation;\n\n// grain\nuniform float uBleed;\nuniform float uGrainRotation;\nuniform float uGrainScale;\nuniform float u_x_offset;\nuniform float u_y_offset;\n\n// brush\nuniform vec2 u_offset_px;\nuniform vec2 u_node_scale;\n\n// from vert shader\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\n// from PIXI\nuniform vec4 filterArea;\nuniform vec2 dimensions;\nuniform vec4 filterClamp;\nuniform mat3 filterMatrix;\n\nvec2 rotate (vec2 v, float a) {\n  float s = sin(a);\n  float c = cos(a);\n  mat2 m = mat2(c, -s, s, c);\n  return m * v;\n}\n\nvec2 scale (vec2 v, vec2 _scale) {\n  mat2 m = mat2(_scale.x, 0.0, 0.0, _scale.y);\n  return m * v;\n}\n\nvec2 mapCoord (vec2 coord) {\n  coord *= filterArea.xy;\n  return coord;\n}\n\nvec2 unmapCoord (vec2 coord) {\n  coord /= filterArea.xy;\n  return coord;\n}\n\nvoid main(void) {\n  // user's intended brush color\n  vec3 color = vec3(uRed, uGreen, uBlue);\n\n  //\n  //\n  // brush\n  //\n  vec2 coord = mapCoord(vTextureCoord) / dimensions;\n\n  // translate by the subpixel\n  coord -= u_offset_px / dimensions;\n\n  // move space from the center to the vec2(0.0)\n  coord -= vec2(0.5);\n\n  // rotate the space\n  coord = rotate(coord, uRotation);\n\n  // move it back to the original place\n  coord += vec2(0.5);\n\n  // scale\n  coord -= 0.5;\n  coord *= 1.0 / u_node_scale;\n  coord += 0.5;\n\n  coord = unmapCoord(coord * dimensions);\n\n  //\n  //\n  // grain\n  //\n  vec2 fcoord = vFilterCoord;\n  fcoord -= vec2(u_x_offset, u_y_offset);\n  fcoord /= uGrainScale;\n  vec4 grainSample = texture2D(u_grainTex, fract(fcoord));\n\n  //\n  //\n  // set gl_FragColor\n  //\n  // clamp (via https://github.com/pixijs/pixi.js/wiki/v4-Creating-Filters#bleeding-problem)\n  if (coord == clamp(coord, filterClamp.xy, filterClamp.zw)) {\n    // read a sample from the texture\n    vec4 brushSample = texture2D(uSampler, coord);\n    // tint\n    gl_FragColor = vec4(color, 1.);\n    gl_FragColor *= ((brushSample.r * grainSample.r * (1.0+uBleed))- uBleed ) * (1.0+ uBleed) * uOpacity;\n\n    // gl_FragColor = grain;\n  } else {\n    // don't draw\n    gl_FragColor = vec4(0.);\n  }\n}\n"}});